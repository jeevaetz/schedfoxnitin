/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * EmployeeSecurityPanel.java
 *
 * Created on May 22, 2010, 4:20:45 PM
 */

package rmischedule.employee.security;

import java.util.Hashtable;
import java.util.Iterator;
import javax.swing.JCheckBox;
import javax.swing.JPanel;
import rmischedule.components.graphicalcomponents.GenericEditSubForm;
import rmischedule.security.security_detail;
import rmischedule.security.security_detail.EMPLOYEE_SEC;
import schedfoxlib.model.util.Record_Set;
import rmischeduleserver.mysqlconnectivity.queries.GeneralQueryFormat;
import rmischeduleserver.mysqlconnectivity.queries.employee.security.get_security_settings_for_emp_group_query;
import rmischeduleserver.mysqlconnectivity.queries.employee.security.save_security_groups_settings_query;

/**
 *
 * @author user
 */
public class EmployeeSecurityPanel extends GenericEditSubForm {

    private EmployeeSecurityGroups empGroups;
    private Hashtable<Integer, JCheckBox> chks;

    /** Creates new form EmployeeSecurityPanel */
    public EmployeeSecurityPanel(EmployeeSecurityGroups empGroups) {
        initComponents();
        chks = new Hashtable<Integer, JCheckBox>();
        this.empGroups = empGroups;
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        setLayout(new javax.swing.BoxLayout(this, javax.swing.BoxLayout.Y_AXIS));
    }// </editor-fold>//GEN-END:initComponents

    @Override
    public GeneralQueryFormat getQuery(boolean isSelected) {
        get_security_settings_for_emp_group_query updateQuery =
                new get_security_settings_for_emp_group_query();
        updateQuery.update(this.myparent.getMyIdForSave());

        return updateQuery;
    }

    @Override
    public GeneralQueryFormat getSaveQuery(boolean isNewData) {
        save_security_groups_settings_query saveQuery = new save_security_groups_settings_query();

        Hashtable<Integer, Integer> values = new Hashtable<Integer, Integer>();
        Iterator<Integer> checks = chks.keySet().iterator();

        while (checks.hasNext()) {
            Integer currCheckInt = checks.next();
            JCheckBox currCheck = chks.get(currCheckInt);
            if (currCheck.isSelected()) {
                values.put(currCheckInt, 1);
            }
        }

        try {
            saveQuery.update(Integer.parseInt(this.myparent.getMyIdForSave()), values);
        } catch (Exception e) {}
        return saveQuery;
    }

    @Override
    public void loadData(Record_Set rs) {
        this.removeAll();
        chks.clear();
        Hashtable<Integer, Integer> values = new Hashtable<Integer, Integer>();
        if (rs.length() > 0) {
            do {
                values.put(rs.getInt("security_setting"), rs.getInt("employee_security_group_id"));
            } while (rs.moveNext());
        }

        for (EMPLOYEE_SEC m : security_detail.EMPLOYEE_SEC.values()) {
            int v = m.getVal() + 1;
            Integer val = values.get(v);
            if (val == null) {
                val = new Integer(0);
            } else {
                val = v;
            }
            IndSecuritySettingPanel indPanel = new IndSecuritySettingPanel(m, val);
            chks.put(m.getVal(), indPanel.getCheckBox());
            this.add(indPanel);
        }
    }

    @Override
    public boolean needsMoreRecordSets() {
        return false;
    }

    @Override
    public String getMyTabTitle() {
        return "Security Settings";
    }

    @Override
    public JPanel getMyForm() {
        return this;
    }

    @Override
    public void doOnClear() {
        this.removeAll();
        chks.clear();
    }

    @Override
    public boolean userHasAccess() {
        return true;
    }



    // Variables declaration - do not modify//GEN-BEGIN:variables
    // End of variables declaration//GEN-END:variables

}
